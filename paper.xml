<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/css" href="resources/css/paper.css"?>
<article xmlns="http://docbook.org/ns/docbook" xmlns:xl="http://www.w3.org/1999/xlink" version="5.0">
	<info>
		<title><emphasis role="bold">Documents from XQuery annotations</emphasis></title>
		<author>
			<personname>Andy Bunce</personname>
			<email>bunce.andy@gmail.com</email>
			<uri><link xmlns:xlink="http://www.w3.org/1999/xlink"
					xlink:href="https://github.com/apb2006">https://github.com/apb2006</link></uri>
			<personblurb>
				<para><?oxy-placeholder content="Details about you"?></para>
			</personblurb>
			<affiliation>
				<jobtitle>Director</jobtitle>
				<orgname>Quodatum Ltd</orgname>
			</affiliation>
		</author>
		<keywordset>
			<keyword>xquery</keyword>
			<keyword>documentation</keyword>
			<keyword>xqdoc</keyword>
			<keyword>annotation</keyword>
			<keyword>restxq</keyword>
		</keywordset>
		<abstract>
			<para>The paper describes an implementation of an xqDoc.org documentation generator. A focus of
				this implementation is XQuery annotation support. In 2014 the xqDoc schema was
				updated to include markup to capture XQuery annotations, however existing renderers
				have often not been updated to make use of this. A major driver for annotation
				support is documenting XQuery web applications built using the RESTXQ standard.
				RESTXQ defines a standard set of XQuery annotations that can be used to define
				RESTful Web Services from XQuery. Annotations are also being used to define
				frameworks for unit testing, user permissioning and web socket interfaces.
				Annotations are code markup that the runtime environment may choose to use to
				wire-in additional external functionality to XQuery applications. The xqdoc
				implementation is open source. It is largely written in XQuery and runs with recent
				versions of BaseX. It generates static, stand alone HTML5 and XML output. The
				included XQuery library modules can also be used to assist in the generation other
				related documentation artefacts. In the case of RESTXQ these could be the generation
				of openAPI(swagger) and WADL documents.</para>
			<para><?oxy-placeholder content="Another paragraph …"?></para>
		</abstract>
	</info>

	<para><?oxy-placeholder content="Leading text before the first section can be here…"?></para>
	<section>
		<title>Introduction</title>
		<para><?oxy-placeholder content="Introductory section goes here…"?></para>
		<para><?oxy-placeholder content="You can use not only paragraphs, but also programlistings, examples, lists, tables, etc."?></para>
	</section>
	<section>
		<title>What are annotations?</title>
		<para>Annotations are defined for many languages Java has <link
				xmlns:xlink="http://www.w3.org/1999/xlink"
				xlink:href="https://www.jcp.org/en/jsr/detail?id=175#2">JSR 175: A Metadata Facility
				for the JavaTM Programming Language</link>.</para>
		<para>The XQuery 3.1 <citation/>specification states: </para>
		<blockquote>
			<para>XQuery uses annotations to declare properties associated with functions (inline or
				declared in the prolog) and variables. For instance, a function may be declared
					<code>%public</code> or <code>%private</code>.  </para>
			<para>Annotations are <code>(QName, value)</code> pairs. </para>
		</blockquote>
		<para/>
	</section>
	<section>
		<title>A survey of the use of annotations in XQuery</title>
		<para>The following sections show popular applications of annotations</para>
		<section>
			<title>Built-in annotations</title>
			<para>The XQuery 3.1 and XQuery 3.0  update standards define only three
				annotations:</para>
			<para><code>%private</code>
				<code>%public</code><code>%updating</code>
			</para>
		</section>
		<section>
			<title>RestXQ</title>
			<para>In ?? Adam Retter presented.  It is based on the popular Java standard JAX-RS and
				has been implemented by many XML database products as it provides a straight forward
				way to wire-up XQuery code to a web services. </para>
			<para>A simple RESTXQ
				example<programlisting>module namespace page = 'http://basex.org/examples/web-page';
 
declare %rest:path("hello/{$who}") %rest:GET function page:hello($who) {
  &lt;response>
    &lt;title>Hello { $who }!&lt;/title>
  &lt;/response>
};  </programlisting></para>
			<para>However as the application size grows it can become difficult for the developer to
				navigate from response to implementing code. </para>
		</section>
		<section>
			<title>Unit testing</title>
			<para>Unit testing is another popular domain for annotations. In the Java world JUnit
				has long made use of annotations. In XQuery <itemizedlist>
					<listitem>
						<para>Marklogic has <link xmlns:xlink="http://www.w3.org/1999/xlink"
								xlink:href="https://github.com/robwhitby/xray">XRAY</link></para>
					</listitem>
				</itemizedlist></para>
		</section>
		<section>
			<title>Others</title>
			<para>The BaseX product has recently extended its <itemizedlist>
					<listitem>
						<para><code>%ws</code> To define access to <link
								xmlns:xlink="http://www.w3.org/1999/xlink"
								xlink:href="http://docs.basex.org/wiki/WebSockets#Annotations">Web
								sockets</link></para>
					</listitem>
					<listitem>
						<para><code>%perm</code> To define a web application permission layer</para>
					</listitem>
				</itemizedlist></para>
			<para>The MarkLogic product uses annotation for <link
					xmlns:xlink="http://www.w3.org/1999/xlink"
					xlink:href="https://docs.marklogic.com/guide/xquery/enhanced#id_94002"
					>transaction control</link> .</para>
		</section>
	</section>
	<section>
		<title>RESTxq annotations</title>
		<para>stuff</para>
	</section>
	<section>
		<title>The xqDoc format</title>
		<para>In 2002, Darin McBeath realised the need for a tool for generating documentation from
			XQuery sources and created  xqDoc <biblioref/>. This defines an XML schema for recording
			information about XQuery modules and a reference JAVA implementation. </para>
		<para>In 2014 this schema was extended to capture XQuery annotation information. The figure
			below highlights the addition: </para>
		<para>
			<inlinemediaobject>
				<imageobject>
					<imagedata fileref="xqdoc-schema.png" width="100%" scalefit="1"/>
				</imageobject>
			</inlinemediaobject></para>
	</section>
	<section>
		<title>xqDoc implementations</title>
		<para>xqDoc implementations have two main components:<orderedlist>
				<listitem>
					<para>A means to parse the source code</para>
				</listitem>
				<listitem>
					<para>Optionally a means to render these into human readable formats such as
						html</para>
					<para>list here</para>
				</listitem>
			</orderedlist></para>
	</section>

	<section>
		<title>Introducing xqDocA</title>
		<para><inlinemediaobject>
				<imageobject>
					<imagedata fileref="xqDocA.png" width="100%" scalefit="1"/>
				</imageobject>
			</inlinemediaobject></para>
	</section>
	
	<section>
		<title>Conclusion</title>
		<para>@TODO</para>

	</section>

	<bibliography xml:id="references">
		<bibliomixed><abbrev>XQUERY31SPEC</abbrev>
			<author>
				<personname><surname>Speigel</surname>
					<firstname>Josh</firstname></personname>
			</author>: <title>XQuery 3.1: An XML Query Language</title>. <date>21 3 2017</date>,
				<orgname>W3C</orgname>
			<bibliomisc><link xl:href="https://www.w3.org/TR/2017/REC-xquery-31-20170321/"
				/></bibliomisc></bibliomixed>
		<bibliomixed><abbrev>RESTXQ</abbrev>
			<author>
				<personname><surname>Retter</surname>
					<firstname>Adam</firstname></personname>
			</author>: <title>RESTXQ 1.0: RESTful Annotations for XQuery</title>. <date>21 March
				2016</date>, <orgname><link xmlns:xlink="http://www.w3.org/1999/xlink"
					xlink:href="http://exquery.org/">http://exquery.org/</link></orgname>
			<bibliomisc><link
					xl:href="http://exquery.github.io/exquery/exquery-restxq-specification/restxq-1.0-specification.html"
				/></bibliomisc></bibliomixed>
		<bibliomixed><abbrev> JAX-RS API</abbrev>
			<author>
				<personname><surname>Bucek</surname>
					<firstname>Pavel</firstname></personname>
			</author>: <title>JSR 370: JavaTM API for RESTful Web Services (JAX-RS 2.1)
				Specification</title>. <date>22 Aug 2017</date>, <orgname>Java Community Process
				(JCP)</orgname>
			<bibliomisc><link><link xmlns:xlink="http://www.w3.org/1999/xlink"
						xlink:href="https://jcp.org/en/jsr/detail?id=370"
						>https://jcp.org/en/jsr/detail?id=370</link></link></bibliomisc></bibliomixed>
		<bibliomixed><abbrev>XQDOC</abbrev>
			<author>
				<personname><surname>McBeath</surname>
					<firstname>Darrin</firstname></personname>
			</author>: <title>xqDoc website</title>. <date>13 Jan 2014</date>, <orgname><link
					xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://xqdoc.org"
					>http://xqdoc.org</link></orgname>
			<bibliomisc><link><link xmlns:xlink="http://www.w3.org/1999/xlink"
						xlink:href="http://xqdoc.org/index.html"
					>http://xqdoc.org/index.html</link></link></bibliomisc></bibliomixed>
		<bibliomixed><abbrev>XPARSE</abbrev>
			<author>
				<personname><surname>Lumley</surname>
					<firstname>John</firstname></personname>
			</author>: <title>XParse Module</title>. <date>8 Dec 2014</date>, <orgname><link
					xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://expath.org/"
					>http://expath.org/</link></orgname>
			<bibliomisc><link><link xmlns:xlink="http://www.w3.org/1999/xlink"
						xlink:href="https://lists.w3.org/Archives/Public/public-expath/2015Feb/att-0003/xparse.html"
						>https://lists.w3.org/Archives/Public/public-expath/2015Feb/att-0003/xparse.html</link></link></bibliomisc></bibliomixed>
		<bibliomixed><abbrev>MARKLOGIC9</abbrev>
			<author>
				<personname><surname><?oxy-placeholder content="Surname"?></surname>
					<firstname><?oxy-placeholder content="Firstname"?></firstname></personname>
			</author>: <title>MarkLogic 9 Product Documentation</title>.
				<date><?oxy-placeholder content="DD Month Year"?></date>,
				<orgname><?oxy-placeholder content="Organization name"?></orgname>
			<bibliomisc><link><link xmlns:xlink="http://www.w3.org/1999/xlink"
						xlink:href="https://docs.marklogic.com/guide/xquery/enhanced#id_94002"
						>https://docs.marklogic.com/guide/xquery/enhanced#id_94002</link></link></bibliomisc></bibliomixed>
	</bibliography>

</article>
